<script>
    function plantApp() {
        return {
            plants: [],
            newName: '',
            summerDays: 7,
            winterDays: 14,
            lastWateredDate: new Date().toISOString().split('T')[0],
            season: 'summer',
            showDeleteModal: false,
            plantToDelete: null,
            
            fullLibrary: [
                { n: 'Aglaonema (Aglaon√©ma)', s: 7, w: 14 },
                { n: 'Aloa prav√° (Aloe Vera)', s: 14, w: 21 },
                { n: 'Amaryllis (Amarylis / Hvƒõzdn√≠k)', s: 5, w: 10 },
                { n: 'Azalka (Rhododendron)', s: 3, w: 6 },
                { n: 'Brom√©lie (Brom√©lia)', s: 7, w: 12 },
                { n: 'Calathea (Kalatea)', s: 3, w: 7 },
                { n: 'Caryota (Rybia palma)', s: 5, w: 10 },
                { n: 'Dieffenbachia (Difenbachia)', s: 5, w: 10 },
                { n: 'Divn√Ω Janko (Epipremnum)', s: 5, w: 12 },
                { n: 'Dracena (Drac√©na)', s: 7, w: 14 },
                { n: 'Echev√©rie (Skaln√° ru≈æa)', s: 10, w: 20 },
                { n: 'Fialka (Africk√°)', s: 4, w: 8 },
                { n: 'Fittonia (Fit√≥nia)', s: 3, w: 6 },
                { n: 'F√≠kus lyrata', s: 5, w: 10 },
                { n: 'Hyacint (Hyacinthus)', s: 4, w: 9 },
                { n: 'Kaktus (Sukulenty)', s: 14, w: 30 },
                { n: 'Kalanchoe (Kolopejka)', s: 10, w: 18 },
                { n: 'K√°vovn√≠k (Coffea)', s: 4, w: 9 },
                { n: 'Levandule (Lavandula)', s: 4, w: 10 },
                { n: 'Lilie (ƒΩalia)', s: 4, w: 8 },
                { n: 'Lopatkovec', s: 3, w: 7 },
                { n: 'Mod≈ôenec (Muscari / Muscar / Modrica)', s: 4, w: 8 },
                { n: 'Monstera deliciosa', s: 7, w: 14 },
                { n: 'Narcis (Narcissus)', s: 4, w: 8 },
                { n: 'Orchidej (Phalaenopsis)', s: 7, w: 10 },
                { n: 'R≈Ø≈æe (Ru≈æa)', s: 3, w: 7 },
                { n: 'Sansevieria (Svokrin jazyk)', s: 14, w: 30 },
                { n: 'Senecio (Starƒçek)', s: 10, w: 20 },
                { n: 'Strelitzia (Strel√≠cia)', s: 6, w: 12 },
                { n: 'Tulip√°n (Tulipa)', s: 3, w: 7 },
                { n: 'V√°noƒçn√≠ hvƒõzda (Vianoƒçn√° hviezda)', s: 5, w: 10 },
                { n: 'V√°noƒçn√≠ kaktus (Vianoƒçn√Ω kaktus)', s: 7, w: 12 },
                { n: 'V≈ôes / V≈ôesovec (Calluna / Erica)', s: 2, w: 5 },
                { n: 'Zamiokulkas', s: 14, w: 25 },
                { n: 'Zelenec', s: 4, w: 10 },
                { n: 'Zvonek (Campanula)', s: 3, w: 7 }
            ],

            getIcon(name) {
                const n = name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                if (n.includes('kaktus') || n.includes('echeve') || n.includes('aloa') || n.includes('sukulent')) return 'üåµ';
                if (n.includes('ruze') || n.includes('ruza') || n.includes('azal') || n.includes('lilie') || n.includes('lalia') || n.includes('fialka') || n.includes('fittonia') || n.includes('tulipan') || n.includes('narcis') || n.includes('modrenec') || n.includes('amaryllis') || n.includes('zvonek') || n.includes('campanula') || n.includes('vres')) return 'üå∏';
                if (n.includes('palma') || n.includes('caryota') || n.includes('juka') || n.includes('yucca') || n.includes('dracena')) return 'üå¥';
                if (n.includes('hvezda') || n.includes('hviezda')) return '‚ú®';
                if (n.includes('strom') || n.includes('fikus') || n.includes('citron') || n.includes('kavovnik')) return 'üå≥';
                if (n.includes('hyacint') || n.includes('levandul')) return 'ü™ª';
                if (n.includes('bylink') || n.includes('mata') || n.includes('bazalka')) return 'üåø';
                if (n.includes('zelenec') || n.includes('asparagus') || n.includes('senecio')) return 'üçÉ';
                return 'ü™¥';
            },

            init() {
                const saved = localStorage.getItem('vibeJunglePro');
                const savedSeason = localStorage.getItem('vibeJungleSeasonPro');
                if (saved) this.plants = JSON.parse(saved);
                if (savedSeason) this.season = savedSeason;
                this.$watch('plants', v => localStorage.setItem('vibeJunglePro', JSON.stringify(v)));
                setInterval(() => this.recalculateAll(), 60000);
            },

            checkLibrary() {
                const input = this.newName.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                if (input.length < 2) return;
                const match = this.fullLibrary.find(item => item.n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(input));
                if (match) { this.summerDays = match.s; this.winterDays = match.w; }
            },

            addPlant() {
                if (!this.newName) return;
                const selectedDate = new Date(this.lastWateredDate);
                const now = new Date();
                const diffDays = Math.floor(Math.abs(now - selectedDate) / 86400000);
                const maxDays = this.season === 'summer' ? this.summerDays : this.winterDays;
                
                this.plants.push({
                    id: Date.now(),
                    name: this.newName,
                    summerDays: parseInt(this.summerDays),
                    winterDays: parseInt(this.winterDays),
                    daysLeft: Math.max(0, maxDays - diffDays),
                    lastWatered: selectedDate.toLocaleDateString('cs-CZ'),
                    lastWateredMs: selectedDate.getTime()
                });
                this.newName = '';
                this.lastWateredDate = new Date().toISOString().split('T')[0];
            },

            waterPlant(id) {
                const now = new Date();
                let p = this.plants.find(p => p.id === id);
                p.lastWatered = now.toLocaleDateString('cs-CZ');
                p.lastWateredMs = now.getTime();
                p.daysLeft = this.season === 'summer' ? p.summerDays : p.winterDays;
            },

            triggerDelete(id) { this.plantToDelete = id; this.showDeleteModal = true; },
            deletePlant() { this.plants = this.plants.filter(p => p.id !== this.plantToDelete); this.showDeleteModal = false; },

            recalculateAll() {
                const now = new Date().getTime();
                this.plants.forEach(p => {
                    const maxDays = this.season === 'summer' ? p.summerDays : p.winterDays;
                    const daysElapsed = Math.floor((now - p.lastWateredMs) / 86400000);
                    p.daysLeft = Math.max(0, maxDays - daysElapsed);
                });
            },

            setSeason(s) {
                this.season = s;
                localStorage.setItem('vibeJungleSeasonPro', s);
                this.recalculateAll();
            }
        }; // Tady chybƒõl tento st≈ôedn√≠k a z√°vorka p≈ôed n√≠m!
    }
</script>



