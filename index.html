<script>
    function plantApp() {
        return {
            plants: [],
            newName: '',
            summerDays: 7,
            winterDays: 14,
            lastWateredDate: new Date().toISOString().split('T')[0],
            season: 'summer',
            showDeleteModal: false,
            plantToDelete: null,
            
            fullLibrary: [
                { n: 'Aglaonema (AglaonÃ©ma)', s: 7, w: 14 },
                { n: 'Aloa pravÃ¡ (Aloe Vera)', s: 14, w: 21 },
                { n: 'Azalka (Rhododendron)', s: 3, w: 6 },
                { n: 'BromÃ©lie (BromÃ©lia)', s: 7, w: 12 },
                { n: 'Calathea (Kalatea)', s: 3, w: 7 },
                { n: 'Caryota (Rybia palma)', s: 5, w: 10 },
                { n: 'Dieffenbachia (Difenbachia)', s: 5, w: 10 },
                { n: 'DivnÃ½ Janko (Epipremnum)', s: 5, w: 12 },
                { n: 'Dracena (DracÃ©na)', s: 7, w: 14 },
                { n: 'EchevÃ©rie (SkalnÃ¡ ruÅ¾a)', s: 10, w: 20 },
                { n: 'Fialka (AfrickÃ¡)', s: 4, w: 8 },
                { n: 'Fittonia (FitÃ³nia)', s: 3, w: 6 },
                { n: 'FÃ­kus lyrata', s: 5, w: 10 },
                { n: 'Kaktus (Sukulenty)', s: 14, w: 30 },
                { n: 'Kalanchoe (Kolopejka)', s: 10, w: 18 },
                { n: 'KÃ¡vovnÃ­k (Coffea)', s: 4, w: 9 },
                { n: 'Lilie (Ä½alia)', s: 4, w: 8 },
                { n: 'Lopatkovec', s: 3, w: 7 },
                { n: 'Monstera deliciosa', s: 7, w: 14 },
                { n: 'Orchidej (Phalaenopsis)', s: 7, w: 10 },
                { n: 'RÅ¯Å¾e (RuÅ¾a)', s: 3, w: 7 },
                { n: 'Sansevieria (Svokrin jazyk)', s: 14, w: 30 },
                { n: 'Senecio (StarÄek)', s: 10, w: 20 },
                { n: 'Strelitzia (StrelÃ­cia)', s: 6, w: 12 },
                { n: 'VÃ¡noÄnÃ­ hvÄ›zda (VianoÄnÃ¡ hviezda)', s: 5, w: 10 },
                { n: 'VÃ¡noÄnÃ­ kaktus (VianoÄnÃ½ kaktus)', s: 7, w: 12 },
                { n: 'Zamiokulkas', s: 14, w: 25 },
                { n: 'Zelenec', s: 4, w: 10 }
            ],

            // OPRAVENÃ LOGIKA IKONEK
            getIcon(name) {
                // PÅ™evede nÃ¡zev na malÃ¡ pÃ­smena a odstranÃ­ hÃ¡Äky/ÄÃ¡rky pro spolehlivÃ© hledÃ¡nÃ­
                const n = name.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                
                if (n.includes('kaktus') || n.includes('echeve') || n.includes('aloa') || n.includes('sukulent')) return 'ðŸŒµ';
                if (n.includes('ruze') || n.includes('ruza') || n.includes('azal') || n.includes('lilie') || n.includes('lalia') || n.includes('fialka') || n.includes('fittonia')) return 'ðŸŒ¸';
                if (n.includes('palma') || n.includes('caryota') || n.includes('juka') || n.includes('yucca') || n.includes('dracena')) return 'ðŸŒ´';
                if (n.includes('hvezda') || n.includes('hviezda')) return 'âœ¨';
                if (n.includes('strom') || n.includes('fikus') || n.includes('citron') || n.includes('kavovnik')) return 'ðŸŒ³';
                if (n.includes('levandul') || n.includes('hyacint')) return 'ðŸª»';
                if (n.includes('bylink') || n.includes('mata') || n.includes('bazalka')) return 'ðŸŒ¿';
                if (n.includes('zelenec') || n.includes('asparagus') || n.includes('senecio')) return 'ðŸƒ';
                
                return 'ðŸª´'; // VÃ½chozÃ­ ikonka pro ostatnÃ­
            },

            init() {
                const saved = localStorage.getItem('vibeJunglePro');
                const savedSeason = localStorage.getItem('vibeJungleSeasonPro');
                if (saved) this.plants = JSON.parse(saved);
                if (savedSeason) this.season = savedSeason;
                this.$watch('plants', v => localStorage.setItem('vibeJunglePro', JSON.stringify(v)));
                setInterval(() => this.recalculateAll(), 60000);
            },

            checkLibrary() {
                const input = this.newName.toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                if (input.length < 2) return;
                const match = this.fullLibrary.find(item => item.n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").includes(input));
                if (match) { this.summerDays = match.s; this.winterDays = match.w; }
            },

            addPlant() {
                if (!this.newName) return;
                const selectedDate = new Date(this.lastWateredDate);
                const now = new Date();
                const diffDays = Math.floor(Math.abs(now - selectedDate) / 86400000);
                const maxDays = this.season === 'summer' ? this.summerDays : this.winterDays;
                
                this.plants.push({
                    id: Date.now(),
                    name: this.newName,
                    summerDays: parseInt(this.summerDays),
                    winterDays: parseInt(this.winterDays),
                    daysLeft: Math.max(0, maxDays - diffDays),
                    lastWatered: selectedDate.toLocaleDateString('cs-CZ'),
                    lastWateredMs: selectedDate.getTime()
                });
                this.newName = '';
                this.lastWateredDate = new Date().toISOString().split('T')[0];
            },

            waterPlant(id) {
                const now = new Date();
                let p = this.plants.find(p => p.id === id);
                p.lastWatered = now.toLocaleDateString('cs-CZ');
                p.lastWateredMs = now.getTime();
                p.daysLeft = this.season === 'summer' ? p.summerDays : p.winterDays;
            },

            triggerDelete(id) { this.plantToDelete = id; this.showDeleteModal = true; },
            deletePlant() { this.plants = this.plants.filter(p => p.id !== this.plantToDelete); this.showDeleteModal = false; },

            recalculateAll() {
                const now = new Date().getTime();
                this.plants.forEach(p => {
                    const maxDays = this.season === 'summer' ? p.summerDays : p.winterDays;
                    const daysElapsed = Math.floor((now - p.lastWateredMs) / 86400000);
                    p.daysLeft = Math.max(0, maxDays - daysElapsed);
                });
            },

            setSeason(s) {
                this.season = s;
                localStorage.setItem('vibeJungleSeasonPro', s);
                this.recalculateAll();
            }
        }
    }
</script>
